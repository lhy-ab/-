# 语法制导翻译

在编译的过程中，语义分析和中间代码生成阶段称为语义翻译，语法分析、语义分析和中间代码生成阶段称为语法制导翻译

语法制导翻译使用用CFG来引导对语言的翻译，是一种面向文法的翻译技术

### 语法制导翻译的基本思想

#### 如何表示语义信息

为CFG中的文法符号设置语义属性，用来表示语法成分对应的语义信息

#### 如何计算语义属性

文法符号的语义属性值是用与文法符号所在产生式（语法规则）相关联的语义规则来计算的

对于给定的输入串x ，构建x的语法分析树，并利用与产生式（语法规则）相关联的语义规则来计算分析树中各结点对应的语义属性值

#### 语法制导定义(SDD)

SDD是对CFG的推广，将每个文法符号和一个语义属性集合相关联，将每个产生式和一组语义规则相关联，这些规则用于计算该产生式中

如果X是一个文法符号，a是X的一个属性，则用X.a表示属性a在某个标号为X的分析树结点上的值

<img src="C:\Users\27923\Desktop\编译原理\微信截图_20250117131551.png" style="zoom:50%;" />

#### 语法制导翻译方案(SDT)

SDT是在产生式右部嵌入了程序片段的CFG，这些程序片段称为语义动作。按照惯例，语义动作放在花括号内

一个语义动作在产生式中的位置决定了这个动作的执行时间

<img src="C:\Users\27923\Desktop\编译原理\微信截图_20250117131651.png" style="zoom:50%;" />

#### SDD与SDT

SDD：是关于语言翻译的高层次规格说明，隐蔽了许多具体实现细节，使用户不必显式地说明翻译发生的顺序

SDT：可以看作是对SDD的一种补充，是SDD的具体实施方案，显式地指明了语义规则的计算顺序，以便说明某些实现细节

### 语法制导定义SDD

语法制导定义SDD是对CFG的推广，将每个文法符号和一个语义属性集合相关联；将每个产生式和一组语义规则相关联，用来计算该产生式中各文法符号的属性值
文法符号的属性：综合属性 ，继承属性

#### 综合属性

在分析树结点 N上的非终结符A的综合属性只能通过N的子结点或N本身的属性值来定义

![](C:\Users\27923\Desktop\编译原理\微信截图_20250120132441.png)

终结符可以具有综合属性。终结符的综合属性值是由词法分析器提供的词法值，因此在SDD中没有计算终结符属性值的语义规则

#### 继承属性

在分析树结点 N上的非终结符A的继承属性只能通过N的父结点、N的兄弟结点或N本身的属性值来定义

![](C:\Users\27923\Desktop\编译原理\微信截图_20250120132544.png)

终结符没有继承属性。终结符从词法分析器处获得的属性值被归为综合属性值

![](C:\Users\27923\Desktop\编译原理\微信截图_20250120132627.png)

![](C:\Users\27923\Desktop\编译原理\微信截图_20250120132633.png)

#### 属性文法

一个没有副作用的SDD有时也称为属性文法，属性文法的规则仅仅通过其它属性值和常量来定义一个属性值

### SDD的求值顺序

SDD为CFG中的文法符号设置语义属性。对于给定的输入串x，应用语义规则计算分析树中各结点对应的属性值

计算顺序：语义规则建立了属性之间的依赖关系，在对语法分析树节点的一个属性求值之前，必须首先求出这个属性值所依赖的所有属性值

#### 依赖图

依赖图是一个描述了分析树中结点属性间依赖关系的有向图，分析树中每个标号为X的结点的每个属性a都对应着依赖图中的一个结点，如果属性X.a的值依赖于属性Y.b的值，则依赖图中有一条从Y.b的结点指向X.a的结点的有向边

![](C:\Users\27923\Desktop\编译原理\微信截图_20250120142809.png)

#### 属性值的计算顺序

可行的求值顺序是满足下列条件的结点序列N1, N2, … , Nk ：如果依赖图中有一条从结点Ni到Nj的边(Ni→Nj), 那么i < j（即：在节点序列中，Ni排在Nj 前面）

这样的排序将一个有向图变成了一个线性排序，这个排序称为这个图的拓扑排序

![](C:\Users\27923\Desktop\编译原理\微信截图_20250120143006.png)

对于只具有综合属性的SDD ，可以按照任何自底向上的顺序计算它们的值
对于同时具有继承属性和综合属性的SDD，由于环的存在，不能确定一个顺序来对各个节点上的属性进行求值

<img src="C:\Users\27923\Desktop\编译原理\微信截图_20250120143104.png" style="zoom:50%;" />

从计算的角度看，给定一个SDD，很难确定是否存在某棵语法分析树，使得SDD的属性之间存在循环依赖关系

但是，存在一个SDD的有用子类，它们能够保证对每棵语法分析树都存在一个求值顺序，因为它们不会产生带有环的依赖图

有两类SDD可以和自顶向下及自底向上的语法分析过程一起高效地实现：S-属性定义 (S-SDD)，L-属性定义 (L-SDD)

### S-属性定义与L-属性定义

#### S-属性定义

仅仅使用综合属性的SDD称为S属性的SDD，或S-属性定义、S-SDD

如果一个SDD是S属性的，可以按照语法分析树节点的任何自底向上顺序来计算它的各个属性值

S-属性定义可以在自底向上的语法分析过程中实现

#### L-属性定义

L-属性定义(也称为L属性的SDD或L-SDD)的直观含义：在一个产生式所关联的各属性之间，依赖图的边可以从左到右，但不能从右到左(因此称为L属性的，L是Left的首字母)

L-SDD的正式定义：

一个SDD是L-属性定义，当且仅当它的每个属性要么是一个综合属性(因此，每个S-属性定义都是L-属性定义)，要么是满足如下条件的继承属性：假设存在一个产生式A→X1X2…Xn，其右部符号Xi (1≤i≤n)的继承属性仅依赖于下列属性：

(1)A的继承属性（若为综合属性，则依赖图会产生环路）<img src="C:\Users\27923\Desktop\编译原理\微信截图_20250120145223.png" style="zoom: 33%;" />；

(2)产生式中Xi左边的符号 X1, X2, … , Xi-1 的属性;

(3)Xi本身的属性，但Xi 的全部属性不能在依赖图中形成环路;

![](C:\Users\27923\Desktop\编译原理\微信截图_20250120145316.png)

此例中，（2）产生式中，Q的i属性值依赖于Q后面的R属性值s，这违反了L-SDD的定义

### 语法制导翻译方案SDT

语法制导翻译方案(SDT )是在产生式右部中嵌入了程序片段(称为语义动作)的CFG，SDT可以看作是SDD的具体实施方案

在这两种情况下，SDT可在语法分析过程中实现：基本文法可以使用LR分析技术，且SDD是S属性的；基本文法可以使用LL分析技术，且SDD是L属性的

#### 将S-SDD转换为SDT

将一个S-SDD转换为SDT的方法：将每个语义动作都放在产生式的最后

#### S-属性定义的SDT 实现

如果一个S-SDD的基本文法可以使用LR分析技术，那么它的SDT可以在LR语法分析过程中实现

![](C:\Users\27923\Desktop\编译原理\微信截图_20250121133752.png)

#### 扩展的LR语法分析栈

在分析栈中使用一个附加的域来存放综合属性值

<img src="C:\Users\27923\Desktop\编译原理\微信截图_20250121134020.png" style="zoom:50%;" />

若支持多个属性，使栈记录变得足够大，或在栈记录中存放指针

#### 将语义动作中的抽象定义式改写成具体可执行的栈操作

![](C:\Users\27923\Desktop\编译原理\微信截图_20250121134446.png)

最后，整体上就是在LR分析的过程中，加入了对栈中符号属性值的操作

#### 将L-SDD转换为SDT

规则：将计算某个非终结符号A的继承属性的动作插入到产生式右部中紧靠在A的本次出现之前的位置上，将计算一个产生式左部符号的综合属性的动作放置在这个产生式右部的最右端

<img src="C:\Users\27923\Desktop\编译原理\微信截图_20250121135046.png" style="zoom:50%;" />

#### L-属性定义的SDT 实现

如果一个L-SDD的基本文法可以使用LL分析技术，那么它的SDT可以在LL或LR语法分析过程中实现

判断是否可用LL分析技术，是看具有相同左部的产生式的SELLECT集是否无交集，若是则可用，反之则不行

#### 在非递归的预测分析过程中进行翻译

<img src="C:\Users\27923\Desktop\编译原理\微信截图_20250121144256.png" style="zoom:50%;" />

扩展语法分析栈：

将被执行的语义动作代码用action表示，A的继承属性由A本身表示，A的综合属性由Asyn表示，这也叫做综合记录

例子：

![](C:\Users\27923\Desktop\编译原理\微信截图_20250122203448.png)

#### 分析栈中的每一个记录都对应着一段执行代码

综合记录出栈时，要将综合属性值复制给后面特定的语义动作
变量展开时（即变量本身的记录出栈时），如果其含有继承属性，则要将继承属性值复制给后面特定的语义动作

![](C:\Users\27923\Desktop\编译原理\微信截图_20250121150524.png)

总的来说，就是在自顶向下的分析过程中，加入语义翻译，在每次对语法栈的操作中加入对非终结符的继承属性和综合属性的操作